FROM ubuntu:bionic-20200311

# Install nodejs lts
ENV NODE_VERSION=12.16.2
RUN apt-get update && \
    apt-get install wget curl ca-certificates rsync -y
RUN curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.34.0/install.sh | bash
ENV NVM_DIR=/root/.nvm
RUN . "$NVM_DIR/nvm.sh" && nvm install ${NODE_VERSION}
RUN . "$NVM_DIR/nvm.sh" && nvm use v${NODE_VERSION}
RUN . "$NVM_DIR/nvm.sh" && nvm alias default v${NODE_VERSION}
ENV PATH="/root/.nvm/versions/node/v${NODE_VERSION}/bin/:${PATH}"
RUN node --version
RUN npm --version

# Install Chrome
RUN wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
RUN dpkg -i google-chrome-stable_current_amd64.deb; apt-get -fy install

ADD https://github.com/Yelp/dumb-init/releases/download/v1.2.2/dumb-init_1.2.2_amd64 /usr/local/bin/dumb-init
RUN chmod +x /usr/local/bin/dumb-init

#Providing all necessary permission to the user jenkins
RUN groupmod -g 999 node && \
   usermod -u 999 node

RUN groupadd -g 1000 jenkins && \
   useradd -u 1000 -g 1000 -m -s /bin/bash jenkins

USER jenkins

ENTRYPOINT ["dumb-init", "--"]
